<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>HMI CLOUD ‚Äì WinTK Monitor</title>

<style>
body {
    background: #2b2b2b;
    font-family: Arial, sans-serif;
}

/* Khung HMI */
#hmi {
    width: 900px;
    height: 500px;
    background: #e6e6e6;
    margin: 30px auto;
    border: 3px solid #333;
}

/* Title bar */
#titlebar {
    height: 38px;
    background: #004aad;
    color: white;
    line-height: 38px;
    padding-left: 10px;
    font-weight: bold;
}

/* Menu WinTK */
#menu {
    background: #d0d0d0;
    padding: 5px;
}
#menu button {
    margin-right: 5px;
    padding: 3px 10px;
    cursor: pointer;
}

/* Screen */
.screen {
    display: none;
    padding: 20px;
}
.screen.active {
    display: block;
}

/* HMI object */
.value-box {
    width: 180px;
    padding: 12px;
    background: black;
    color: lime;
    font-size: 30px;
    text-align: center;
    border: 2px inset #555;
}

/* Status */
#status {
    display: flex;
    align-items: center;
    margin-top: 10px;
}
#statusDot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: red;
    margin-right: 8px;
}
</style>
</head>

<body>

<div id="hmi">
    <div id="titlebar">HMI CLOUD MONITOR (WinTK Style)</div>

    <div id="menu">
        <button onclick="showScreen('screen1')">M√†n h√¨nh 1</button>
        <button onclick="showScreen('screen2')">M√†n h√¨nh 2</button>
        <button onclick="showScreen('screen3')">M√†n h√¨nh 3</button>
    </div>

    <!-- SCREEN 1 -->
    <div id="screen1" class="screen active">
        <h3>üìü M√ÄN H√åNH CH√çNH</h3>
        Gi√° tr·ªã PLC:
        <div class="value-box" id="plcValue">---</div>

        <div id="status">
            <div id="statusDot"></div>
            <span id="statusText">Disconnected</span>
        </div>
    </div>

    <!-- SCREEN 2 -->
    <div id="screen2" class="screen">
        <h3>‚öôÔ∏è TH√îNG TIN K·∫æT N·ªêI</h3>
        <p>Web ch·ªâ hi·ªÉn th·ªã d·ªØ li·ªáu t·ª´ Cloud</p>
        <p>Kh√¥ng ƒëi·ªÅu khi·ªÉn PLC</p>
        <p>Polling: 500 ms</p>
        <p>Timeout: 2 s</p>
    </div>

    <!-- SCREEN 3 -->
    <div id="screen3" class="screen">
        <h3>üìä GI√ÅM S√ÅT</h3>
        Gi√° tr·ªã hi·ªán t·∫°i:
        <div class="value-box" id="mirrorValue">---</div>
    </div>
</div>

<script>
/* Chuy·ªÉn m√†n h√¨nh */
function showScreen(id) {
    document.querySelectorAll('.screen')
        .forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

/* Watchdog */
let lastUpdate = 0;

/* Fetch d·ªØ li·ªáu th·∫≠t t·ª´ Cloud */
async function fetchCloudData() {
    try {
        const res = await fetch("/data");
        const data = await res.json();

        lastUpdate = Date.now();
        updateUI(data.value, true);

    } catch (err) {
        checkTimeout();
    }
}

/* Ki·ªÉm tra m·∫•t k·∫øt n·ªëi */
function checkTimeout() {
    if (Date.now() - lastUpdate > 2000) {
        updateUI("---", false);
    }
}

/* Update HMI */
function updateUI(value, connected) {
    document.getElementById("plcValue").innerText = value;
    document.getElementById("mirrorValue").innerText = value;

    document.getElementById("statusText").innerText =
        connected ? "Connected" : "Disconnected";

    document.getElementById("statusDot").style.background =
        connected ? "lime" : "red";
}

/* Polling gi·ªëng HMI th·∫≠t */
setInterval(fetchCloudData, 500);
setInterval(checkTimeout, 500);
</script>

</body>
</html>
