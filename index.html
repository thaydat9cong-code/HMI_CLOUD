<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HMI CLOUD – Virtual HMI</title>

<style>
body{
  margin:0;
  background:#020617;
  font-family: Consolas, Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:white;
}

.hmi{
  background:#0f172a;
  border-radius:16px;
  padding:30px;
  width:420px;
  box-shadow:0 0 40px #38bdf8;
}

.title{
  text-align:center;
  font-size:22px;
  color:#38bdf8;
  margin-bottom:20px;
}

/* Numeric display */
.display{
  background:black;
  border-radius:8px;
  padding:15px;
  font-size:72px;
  color:#22c55e;
  text-align:right;
  margin-bottom:20px;
}

/* Lamp */
.lamp{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:20px;
}

.dot{
  width:16px;
  height:16px;
  border-radius:50%;
  background:red;
  box-shadow:0 0 8px red;
}

.dot.on{
  background:#22c55e;
  box-shadow:0 0 10px #22c55e;
}

/* Progress bar */
.bar{
  background:#020617;
  border-radius:8px;
  height:20px;
  overflow:hidden;
  margin-bottom:20px;
}

.bar-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#22c55e,#38bdf8);
}

/* Buttons */
.buttons{
  display:flex;
  gap:15px;
}

button{
  flex:1;
  padding:12px;
  font-size:18px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  color:white;
}

.start{ background:#22c55e; }
.stop{ background:#ef4444; }
</style>
</head>

<body>

<div class="hmi">
  <div class="title">HMI CLOUD – VIRTUAL PANEL</div>

  <div id="value" class="display">0</div>

  <div class="lamp">
    <div id="lamp" class="dot"></div>
    <div id="status">Disconnected</div>
  </div>

  <div class="bar">
    <div id="bar" class="bar-fill"></div>
  </div>

  <div class="buttons">
    <button class="start" onclick="sendCmd(1)">START</button>
    <button class="stop" onclick="sendCmd(0)">STOP</button>
  </div>
</div>

<script>
async function loadData(){
  try{
    const res = await fetch("/data");
    const data = await res.json();

    const v = data.value || 0;
    document.getElementById("value").innerText = v;

    // Lamp
    const lamp = document.getElementById("lamp");
    const status = document.getElementById("status");

    if(data.status === "Connected"){
      lamp.classList.add("on");
      status.innerText = "Connected";
    }else{
      lamp.classList.remove("on");
      status.innerText = "Disconnected";
    }

    // Bar (giả sử 0–100)
    document.getElementById("bar").style.width = Math.min(v,100) + "%";

  }catch(e){}
}

setInterval(loadData, 1000);

// gửi lệnh (chuẩn bị cho bước điều khiển)
function sendCmd(cmd){
  fetch("/cmd",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({cmd})
  });
}
</script>

</body>
</html>
